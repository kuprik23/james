<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CYBERCAT Activity Monitor | Emersa Ltd</title>
  <link rel="icon" type="image/svg+xml" href="/images/cybercat-logo.svg">
  <style>
    :root {
      --matrix-green: #00ff88;
      --dark-bg: #0a0a0f;
      --card-bg: #12121a;
      --border: #2a2a3a;
      --text-primary: #ffffff;
      --text-secondary: #a0a0b0;
      --cyan: #00d4ff;
      --purple: #7c3aed;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: var(--dark-bg);
      color: var(--text-primary);
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      overflow: hidden;
    }

    .container {
      display: grid;
      grid-template-rows: auto 1fr auto;
      height: 100vh;
    }

    /* Header */
    .header {
      background: var(--card-bg);
      border-bottom: 2px solid var(--matrix-green);
      padding: 16px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo-section {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .ascii-logo {
      color: var(--matrix-green);
      font-family: monospace;
      font-size: 8px;
      line-height: 1;
      text-shadow: 0 0 10px var(--matrix-green);
    }

    .header-title {
      display: flex;
      flex-direction: column;
    }

    .title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--cyan);
      text-shadow: 0 0 10px var(--cyan);
    }

    .subtitle {
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    .status-badge {
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .status-badge.scanning {
      background: linear-gradient(135deg, var(--warning)30, var(--danger)30);
      animation: pulse 2s infinite;
    }

    .status-badge.idle {
      background: linear-gradient(135deg, var(--success)30, var(--cyan)30);
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    /* Main Content */
    .main-content {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
      padding: 20px;
      overflow: hidden;
    }

    /* Activity Panel */
    .activity-panel {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .panel-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .panel-title {
      font-size: 1.125rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .activity-feed {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      min-height: 600px; /* Ensure at least 20 lines visible */
      max-height: calc(100vh - 400px);
    }

    .activity-item {
      display: flex;
      gap: 12px;
      padding: 10px 12px; /* Slightly reduced padding for more lines */
      margin-bottom: 6px;
      background: var(--dark-bg);
      border-radius: 8px;
      border-left: 3px solid var(--matrix-green);
      animation: slideIn 0.3s ease-out;
      font-size: 0.9rem; /* Slightly smaller text for more lines */
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .activity-icon {
      font-size: 1.5rem;
      flex-shrink: 0;
    }

    .activity-content {
      flex: 1;
    }

    .activity-title {
      font-weight: 600;
      margin-bottom: 4px;
      color: var(--matrix-green);
    }

    .activity-desc {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .activity-time {
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-top: 4px;
    }

    /* Progress Section */
    .progress-section {
      padding: 16px 20px;
      border-top: 1px solid var(--border);
      background: var(--dark-bg);
    }

    .progress-bar {
      width: 100%;
      height: 24px;
      background: var(--card-bg);
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 8px;
      position: relative;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--matrix-green), var(--cyan));
      transition: width 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .progress-stats {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    /* History Panel */
    .history-panel {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .history-list {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
    }

    .history-item {
      padding: 12px;
      margin-bottom: 8px;
      background: var(--dark-bg);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .history-item:hover {
      background: var(--border);
      border-left: 3px solid var(--cyan);
      padding-left: 9px;
    }

    .history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .history-type {
      font-weight: 600;
      color: var(--cyan);
    }

    .history-status {
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .history-status.success {
      background: var(--success)30;
      color: var(--success);
    }

    .history-status.warning {
      background: var(--warning)30;
      color: var(--warning);
    }

    .history-status.danger {
      background: var(--danger)30;
      color: var(--danger);
    }

    .history-details {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .history-time {
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-top: 4px;
    }

    /* Footer */
    .footer {
      background: var(--card-bg);
      border-top: 1px solid var(--border);
      padding: 12px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .copyright {
      color: var(--matrix-green);
    }

    /* Buttons */
    .btn {
      padding: 8px 16px;
      border-radius: 8px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--matrix-green), var(--cyan));
      color: var(--dark-bg);
    }

    .btn-primary:hover {
      transform: scale(1.05);
      box-shadow: 0 0 20px var(--matrix-green);
    }

    .btn-secondary {
      background: var(--border);
      color: var(--text-primary);
    }

    .btn-secondary:hover {
      background: var(--text-secondary);
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--dark-bg);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--matrix-green);
    }

    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }

    .stat-card {
      background: var(--dark-bg);
      padding: 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
      text-align: center;
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--matrix-green);
      text-shadow: 0 0 10px var(--matrix-green);
    }

    .stat-label {
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-top: 4px;
    }

    /* Modal for detailed view */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: var(--card-bg);
      border: 1px solid var(--matrix-green);
      border-radius: 12px;
      padding: 24px;
      max-width: 800px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 0 40px var(--matrix-green);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border);
    }

    .modal-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--cyan);
    }

    .close-btn {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 1.5rem;
      cursor: pointer;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.2s;
    }

    .close-btn:hover {
      background: var(--border);
      color: var(--text-primary);
    }

    pre {
      background: var(--dark-bg);
      padding: 16px;
      border-radius: 8px;
      overflow-x: auto;
      font-family: monospace;
      font-size: 0.875rem;
      border: 1px solid var(--border);
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="logo-section">
        <pre class="ascii-logo">    /\_____/\
   /  o   o  \
  ( ==  ^  == )
   )         (
  (           )
 ( (  )   (  ) )
(__(__)___(__)__)</pre>
        <div class="header-title">
          <div class="title">CYBERCAT Activity Monitor</div>
          <div class="subtitle">Real-time Security Scanning & Analysis ‚Ä¢ Emersa Ltd</div>
        </div>
      </div>
      <div class="status-badge idle" id="statusBadge">
        <span class="status-dot" style="width: 8px; height: 8px; border-radius: 50%; background: var(--success);"></span>
        <span id="statusText">Idle</span>
      </div>
    </header>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Real-time Activity Feed -->
      <div class="activity-panel">
        <div class="panel-header">
          <div class="panel-title">
            <span>üìä</span>
            <span>Live Activity Feed</span>
          </div>
          <div style="display: flex; gap: 8px;">
            <button class="btn btn-secondary" onclick="clearActivity()">Clear</button>
            <button class="btn btn-primary" onclick="startScan()">Start Scan</button>
          </div>
        </div>

        <!-- Stats Grid -->
        <div style="padding: 16px;">
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-value" id="filesScanned">0</div>
              <div class="stat-label">Files Scanned</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="threatsFound">0</div>
              <div class="stat-label">Threats Found</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="activitiesLogged">0</div>
              <div class="stat-label">Activities</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="scanTime">0s</div>
              <div class="stat-label">Scan Time</div>
            </div>
          </div>
        </div>

        <!-- Activity Feed -->
        <div class="activity-feed" id="activityFeed">
          <div class="activity-item">
            <div class="activity-icon">üõ°Ô∏è</div>
            <div class="activity-content">
              <div class="activity-title">System Ready</div>
              <div class="activity-desc">CYBERCAT protection systems initialized and standing by</div>
              <div class="activity-time">Just now</div>
            </div>
          </div>
        </div>

        <!-- Progress Section -->
        <div class="progress-section" style="display: none;" id="progressSection">
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%;">
              <span id="progressText">0%</span>
            </div>
          </div>
          <div class="progress-stats">
            <span id="currentTask">Idle</span>
            <span id="itemsProcessed">0 / 0 items</span>
          </div>
        </div>
      </div>

      <!-- History/Log Panel -->
      <div class="history-panel">
        <div class="panel-header">
          <div class="panel-title">
            <span>üìú</span>
            <span>Scan History & Reports</span>
          </div>
          <button class="btn btn-secondary btn-sm" onclick="exportHistory()">Export</button>
        </div>

        <div class="history-list" id="historyList">
          <div class="history-item" onclick="viewReport('welcome')">
            <div class="history-header">
              <span class="history-type">üéâ Welcome</span>
              <span class="history-status success">Ready</span>
            </div>
            <div class="history-details">CYBERCAT platform initialized successfully</div>
            <div class="history-time">Just now</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <div class="copyright">Copyright ¬© 2025 Emersa Ltd. Made in California, USA üá∫üá∏</div>
      <div>
        <span>Active Protections: </span>
        <span style="color: var(--success);">‚úì Anti-Malware</span>
        <span style="margin: 0 8px;">‚Ä¢</span>
        <span style="color: var(--success);">‚úì Anti-Ransomware</span>
        <span style="margin: 0 8px;">‚Ä¢</span>
        <span style="color: var(--success);">‚úì DDoS Shield</span>
      </div>
      <div id="lastUpdate">Last update: Never</div>
    </footer>
  </div>

  <!-- Modal for Detailed Report View -->
  <div class="modal" id="reportModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title" id="modalTitle">Scan Report Details</div>
        <button class="close-btn" onclick="closeModal()">&times;</button>
      </div>
      <div id="modalBody">
        <pre id="reportContent">Loading...</pre>
      </div>
    </div>
  </div>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    // Connect to Socket.IO
    const socket = io();

    // State
    let scanning = false;
    let activityCount = 0;
    let historyItems = [];
    let scanStartTime = null;
    let stats = {
      filesScanned: 0,
      threatsFound: 0,
      scanTime: 0
    };

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      setupSocketHandlers();
      loadHistory();
      startActivityTimer();
    });

    function setupSocketHandlers() {
      socket.on('connect', () => {
        addActivity('üü¢', 'Connected', 'Connected to CYBERCAT server', 'success');
      });

      socket.on('disconnect', () => {
        addActivity('üî¥', 'Disconnected', 'Connection to server lost', 'danger');
      });

      socket.on('security_alert', (alert) => {
        addActivity('üö®', 'Security Alert', alert.message, 'danger');
        stats.threatsFound++;
        updateStats();
      });

      socket.on('toolStart', (data) => {
        addActivity('üîß', 'Tool Started', `Executing: ${data.tool}`, 'info');
        setScanning(true, data.tool);
      });

      socket.on('toolResult', (data) => {
        addActivity('‚úÖ', 'Tool Complete', `Finished: ${data.tool}`, 'success');
        addToHistory(data.tool, data.result, 'success');
        setScanning(false);
      });

      socket.on('toolError', (data) => {
        addActivity('‚ùå', 'Tool Error', `Failed: ${data.tool} - ${data.error}`, 'danger');
        setScanning(false);
      });
    }

    function addActivity(icon, title, description, type = 'info') {
      const feed = document.getElementById('activityFeed');
      const item = document.createElement('div');
      item.className = 'activity-item';
      
      item.innerHTML = `
        <div class="activity-icon">${icon}</div>
        <div class="activity-content">
          <div class="activity-title">${title}</div>
          <div class="activity-desc">${description}</div>
          <div class="activity-time">${new Date().toLocaleTimeString()}</div>
        </div>
      `;
      
      feed.insertBefore(item, feed.firstChild);
      
      // Keep only last 50 items
      while (feed.children.length > 50) {
        feed.removeChild(feed.lastChild);
      }
      
      activityCount++;
      document.getElementById('activitiesLogged').textContent = activityCount;
    }

    function setScanning(isScanning, taskName = 'Scanning') {
      scanning = isScanning;
      const badge = document.getElementById('statusBadge');
      const statusText = document.getElementById('statusText');
      const progressSection = document.getElementById('progressSection');
      
      if (isScanning) {
        badge.className = 'status-badge scanning';
        statusText.textContent = 'Scanning...';
        progressSection.style.display = 'block';
        document.getElementById('currentTask').textContent = taskName;
        scanStartTime = Date.now();
      } else {
        badge.className = 'status-badge idle';
        statusText.textContent = 'Idle';
        progressSection.style.display = 'none';
        if (scanStartTime) {
          stats.scanTime = Math.round((Date.now() - scanStartTime) / 1000);
          updateStats();
        }
      }
    }

    function updateProgress(percent, current, total) {
      document.getElementById('progressFill').style.width = percent + '%';
      document.getElementById('progressText').textContent = Math.round(percent) + '%';
      document.getElementById('itemsProcessed').textContent = `${current} / ${total} items`;
    }

    function updateStats() {
      document.getElementById('filesScanned').textContent = stats.filesScanned;
      document.getElementById('threatsFound').textContent = stats.threatsFound;
      document.getElementById('scanTime').textContent = stats.scanTime + 's';
    }

    function addToHistory(type, result, status) {
      const item = {
        id: Date.now(),
        type: type,
        result: result,
        status: status,
        timestamp: new Date().toISOString()
      };
      
      historyItems.unshift(item);
      saveHistory();
      renderHistory();
    }

    function renderHistory() {
      const list = document.getElementById('historyList');
      
      if (historyItems.length === 0) {
        list.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--text-secondary);">No scan history yet</div>';
        return;
      }
      
      list.innerHTML = historyItems.map(item => `
        <div class="history-item" onclick="viewReport('${item.id}')">
          <div class="history-header">
            <span class="history-type">${getToolIcon(item.type)} ${item.type}</span>
            <span class="history-status ${item.status}">${item.status.toUpperCase()}</span>
          </div>
          <div class="history-details">${getResultSummary(item.result)}</div>
          <div class="history-time">${new Date(item.timestamp).toLocaleString()}</div>
        </div>
      `).join('');
    }

    function getToolIcon(type) {
      const icons = {
        'port_scan': 'üîå',
        'system_analysis': 'üíª',
        'network_analysis': 'üåê',
        'security_report': 'üìä',
        'malware_scan': 'ü¶†',
        'process_analysis': '‚öôÔ∏è'
      };
      return icons[type] || 'üîß';
    }

    function getResultSummary(result) {
      if (typeof result === 'object') {
        if (result.openPorts) return `Found ${result.openPorts.length} open ports`;
        if (result.score) return `Security score: ${result.score}/100`;
        if (result.threatsFound !== undefined) return `${result.threatsFound} threats detected`;
        return 'Scan completed successfully';
      }
      return 'Results available';
    }

    function viewReport(itemId) {
      const item = historyItems.find(i => i.id == itemId);
      if (!item) {
        if (itemId === 'welcome') {
          document.getElementById('modalTitle').textContent = 'üéâ Welcome to CYBERCAT';
          document.getElementById('reportContent').textContent = 
            'CYBERCAT Activity Monitor\n\n' +
            'This window shows real-time scanning activities and maintains\n' +
            'a complete history of all security operations.\n\n' +
            'Features:\n' +
            '‚Ä¢ Live activity feed\n' +
            '‚Ä¢ Scan progress tracking\n' +
            '‚Ä¢ Complete scan history\n' +
            '‚Ä¢ Detailed report viewing\n' +
            '‚Ä¢ Export capabilities\n\n' +
            'Copyright ¬© 2025 Emersa Ltd.\n' +
            'Made in California, USA üá∫üá∏';
        }
      } else {
        document.getElementById('modalTitle').textContent = `${getToolIcon(item.type)} ${item.type} - ${new Date(item.timestamp).toLocaleString()}`;
        document.getElementById('reportContent').textContent = JSON.stringify(item.result, null, 2);
      }
      
      document.getElementById('reportModal').classList.add('active');
    }

    function closeModal() {
      document.getElementById('reportModal').classList.remove('active');
    }

    function clearActivity() {
      const feed = document.getElementById('activityFeed');
      feed.innerHTML = '';
      activityCount = 0;
      document.getElementById('activitiesLogged').textContent = '0';
      addActivity('üóëÔ∏è', 'Activity Cleared', 'Activity feed has been cleared', 'info');
    }

    function saveHistory() {
      try {
        localStorage.setItem('cybercat_history', JSON.stringify(historyItems.slice(0, 100)));
      } catch (e) {
        console.error('Failed to save history:', e);
      }
    }

    function loadHistory() {
      try {
        const saved = localStorage.getItem('cybercat_history');
        if (saved) {
          historyItems = JSON.parse(saved);
          renderHistory();
        }
      } catch (e) {
        console.error('Failed to load history:', e);
      }
    }

    function exportHistory() {
      const data = JSON.stringify(historyItems, null, 2);
      const blob = new Blob([data], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `cybercat-history-${Date.now()}.json`;
      a.click();
      URL.revokeObjectURL(url);
      
      addActivity('üíæ', 'History Exported', `Exported ${historyItems.length} scan reports`, 'success');
    }

    async function startScan() {
      if (scanning) return;
      
      addActivity('üîç', 'Scan Started', 'Initiating comprehensive security scan...', 'info');
      setScanning(true, 'Full Security Scan');
      
      let progress = 0;
      const tasks = [
        { name: 'System Analysis', endpoint: '/api/scan/system' },
        { name: 'Network Analysis', endpoint: '/api/scan/network' },
        { name: 'Port Scan', endpoint: '/api/scan/ports', body: { host: 'localhost' } },
        { name: 'Security Report', endpoint: '/api/report' }
      ];
      
      for (let i = 0; i < tasks.length; i++) {
        const task = tasks[i];
        addActivity('‚è≥', task.name, `Running ${task.name}...`, 'info');
        
        try {
          const response = await fetch(task.endpoint, {
            method: task.body ? 'POST' : 'GET',
            headers: task.body ? { 'Content-Type': 'application/json' } : {},
            body: task.body ? JSON.stringify(task.body) : undefined
          });
          
          const result = await response.json();
          
          addActivity('‚úÖ', task.name + ' Complete', `Completed successfully`, 'success');
          addToHistory(task.name.toLowerCase().replace(' ', '_'), result, 'success');
          
          stats.filesScanned += result.filesScanned || 0;
          stats.threatsFound += result.threatsFound || (result.issues?.length || 0);
          
        } catch (error) {
          addActivity('‚ùå', task.name + ' Failed', error.message, 'danger');
          addToHistory(task.name.toLowerCase().replace(' ', '_'), { error: error.message }, 'danger');
        }
        
        progress = ((i + 1) / tasks.length) * 100;
        updateProgress(progress, i + 1, tasks.length);
        updateStats();
      }
      
      setScanning(false);
      addActivity('üéâ', 'Scan Complete', 'Full security scan completed successfully', 'success');
    }

    function startActivityTimer() {
      setInterval(() => {
        document.getElementById('lastUpdate').textContent = 
          `Last update: ${new Date().toLocaleTimeString()}`;
      }, 1000);
    }

    // Close modal on outside click
    document.getElementById('reportModal').addEventListener('click', (e) => {
      if (e.target.id === 'reportModal') {
        closeModal();
      }
    });
  </script>
</body>
</html>